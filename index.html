<!DOCTYPE html>
<html class="default-style" lang="en">
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>Semantic-Web Praktikum</title>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">

    <link rel="icon" type="image/x-icon" href="./index.ico">
    <script src="https://d3js.org/d3.v5.min.js"></script>

    <link rel="shortcut icon" type="image/x-icon" href="./index.ico">
    <link rel="apple-touch-icon" href="./index.png">
    <link rel="shortcut icon" href="./index.png" sizes="196x196">

    <!-- Hier binden wir alle notwendigen Stylesheet dokumente ein, welche unter anderem Bootstrap - eine bekannte und beliebte Bibliothek enthalten -->
    <link href="./style/css.css" rel="stylesheet">
    <link rel="stylesheet" href="./style/main.css">
    <link rel="stylesheet" href="./style/bootstrap-material.css">
    <link rel="stylesheet" href="./style/shreerang-material.css">

    <!--    <script id="js2" type="text/javascript" src="js/index.js"></script>-->


<body>
<!-- Das hier ist die gesamte leere Struktur, welches das Gerüst für die Webseite baut. Diese Div Container sind zunächst leer und werden erst später durch d3 gefüllt -->
<div class="layout-wrapper layout-1 layout-without-sidenav">
    <div class="layout-inner">
        <nav class="layout-navbar navbar navbar-expand-lg align-items-lg-center bg-dark" id="layout-navbar">
            <div class="f-container">
                <a href="" class="navbar-brand app-brand demo d-lg-none py-2 mr-4">
                        <span class="app-brand-logo">
                            <img src="./index.png" alt="Logo" width="100" height="100"
                                 style="max-width:100%;height:auto;">
                        </span>
                    <span class="app-brand-text font-weight-bold ml-3">RDF Film Database</span>
                </a>
            </div>
        </nav>

        <div class="f-container f-flex-grow-1 f-padding-y">
            <h4 class="font-weight-bold py-3 mb-0">Semantic Web Praktikum</h4>


            <div class="row">
                <div class="col-lg-12">
                    <div class="card mb-4">
                        <div class="card-header with-elements">
                            <h6 class="card-header-title mb-0">Auswahl des Films</h6>
                        </div>

                        <div class="card-body mb-0 text-muted overflow-auto" id="rules"
                             style="text-align: justify; -ms-overflow-style: none;">
                            <p class="font-weight-bold">
                                Bitte einen Filmtitel eingeben und anschließend auf Submit klicken!
                            </p>
                            <form action="javascript:getJSONFromAPI()">
                                <label class="label mb-1 font-weight-bold" for="filmName">Filmtitel</label><br>
                                <input class="col-lg-4" type="text" id="filmName" name="fname"><br><br>
                                <input type="submit" id="btn1" value="Submit">
                            </form>
                        </div>
                    </div>
                </div>
            </div>


            <div class="row">
                <div class="col">
                    <div class="card mb-4">
                        <div class="card-header with-elements">
                            <h6 class="card-header-title mb-0">RDF Graph</h6>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-lg-12 mb-4">
                                    <div id="graph_scatter_global_1"></div>
                                </div>
                                <div class="col-lg-12 mb-4">
                                    <p id="graph_scatter_global_2"></p>
                                </div>

                            </div>
                            <div id="button_scatter_global"></div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
        <nav class="layout-footer footer footer-light">
            <div class="f-container-fluid d-flex flex-wrap justify-content-between text-center f-container-p-x pb-3">
                <div class="pt-3">

                </div>
                <span class="pt-3">Alle Rechte vorbehalten. Richtigkeit sowie Aktualität nicht gewährleistet.</span>
                <!--div>
                    <a href="" class="footer-link pt-3">About Us</a>
                    <a href="" class="footer-link pt-3 ml-4">Help</a>
                    <a href="" class="footer-link pt-3 ml-4">Contact</a>
                    <a href="" class="footer-link pt-3 ml-4">Terms &amp; Conditions</a>
                </div-->
            </div>
        </nav>

    </div>
</div>

<script>
    function showSVG() {
        const width = "100%";
        const height = "100%";

        d3.select("svg").remove();

        const svg = d3.select("#graph_scatter_global_1").append("svg")
            .attr("width", width)
            .attr("height", height);


        const img = svg.append("svg:image")
            .attr("xlink:href", "./python/graph.svg")
            .attr("width", "100%")
            .attr("height", "100%")
            .attr("x", 0)
            .attr("y", 0);
    }


    function getJSONFromAPI() {
        const filmTitle = document.getElementById('filmName').value;
        const url = "http://www.omdbapi.com/?apikey=faeed64f&t=" + filmTitle;
        console.log(url)
        fetch(url)
            .then(function (response) {
                if (response.status >= 400) {
                    throw new Error("Bad response from server");
                }
                return response.json();
            })
            .then(function (stories) {
                var res = JSON.stringify(stories).toString();
                var progData = progressData(res);
                console.log(res);
                console.log(progData);
                document.getElementById('graph_scatter_global_2').innerHTML = "<xmp>" + progData + "</xmp>"
            });


    }

    function progressData(data) {
        console.log('progressing');
        var json = JSON.parse(data);
        var url = "root";
        var comment = "";
        rdf = triplify(url, json, comment);
        console.log('\n' + rdf)
        return rdf;
    }


    function triplify(url, obj, s) {
        if (typeof obj === "object") {
            for (var i in obj) {
                if (i === "events") s += map_events(url, obj, i); else if (i === "properties") s += map_properties(url, obj, i); else if (i === "actions") s += map_actions(url, obj, i); else s += map_field(url, obj, i);
            }
        }
        return s;
    }

    function map_events(url, obj, i) {
        var value = obj[i];

        if (typeof value === "string") {
            return '<' + url + ', ' + i + ', ' + value + '>\n';
        }

        if (typeof value === "number") {
            return '<' + url + ', ' + i + ', ' + value + '>\n';
        }

        if (typeof value === "object") {
            var s = "";
            for (var j in value) {
                s += '<' + url + ', ' + i + ', ' + j + '>\n';
                if (typeof value[j] === "string") s += '<' + j + ', type, ' + value[j] + '>\n'; else if (typeof value[j] === "object") {
                    for (var k in value[j]) {
                        s += '<' + j + ', param, ' + k + '>\n';
                        if (typeof value[j][k] === "string") s += '<' + k + ', type, ' + value[j][k] + '>\n';
                    }
                }
            }
            return s;
        }

        if (typeof value === "array") {
            return '<' + url + ', ' + i + ', ' + value + '>\n';
        }

        if (value == null) {
            return '<' + url + ', ' + i + ', ' + 'null' + '>\n';
        }
    }

    function map_properties(url, obj, i) {
        var value = obj[i];

        if (typeof value === "string") {
            return '<' + url + ', ' + i + ', ' + value + '>\n';
        }

        if (typeof value === "number") {
            return '<' + url + ', ' + i + ', ' + value + '>\n';
        }

        if (typeof value === "object") {
            var s = "";
            for (var j in value) {
                s += '<' + url + ', ' + i + ', ' + j + '>\n';
                if (typeof value[j] === "string") s += '<' + j + ', type, ' + value[j] + '>\n'; else if (typeof value[j] === "object") {
                    for (var k in value[j]) {
                        var field = value[j];
                        var fvalue = field[k];
                        if (typeof (value[j][k]) === "object") {
                            for (var l in fvalue) {
                                s += '<' + j + ', ' + 'property' + ', ' + l + '>\n';
                                s += '<' + l + ', ' + 'type' + ', ' + fvalue[l] + '>\n';
                            }
                        } else s += '<' + j + ', ' + k + ', ' + value[j][k] + '>\n';
                    }
                }
            }
            return s;
        }

        if (typeof value === "array") {
            return '<' + url + ', ' + i + ', ' + value + '>\n';
        }

        if (value == null) {
            return '<' + url + ', ' + i + ', ' + 'null' + '>\n';
        }
    }

    function map_actions(url, obj, i) {
        var value = obj[i];

        if (typeof value === "string") {
            return '<' + url + ', ' + i + ', ' + value + '>\n';
        }

        if (typeof value === "number") {
            return '<' + url + ', ' + i + ', ' + value + '>\n';
        }

        if (typeof value === "object") {
            var s = "";
            for (var j in value) {
                s += '<' + url + ', ' + i + ', ' + j + '>\n';
                if (typeof value[j] === "string") s += '<' + j + ', type, ' + value[j] + '>\n'; else if (typeof value[j] === "object") {
                    for (var k in value[j]) {
                        var field = value[j];
                        var fvalue = field[k];
                        if (typeof fvalue === "object") {
                            for (var l in fvalue) {
                                s += '<' + j + ', ' + k + ', ' + l + '>\n';
                                s += '<' + l + ', ' + 'type' + ', ' + fvalue[l] + '>\n';
                            }
                        } else s += '<' + j + ', ' + k + ', ' + value[j][k] + '>\n';
                    }
                }
            }
            return s;
        }

        if (typeof value === "array") {
            return '<' + url + ', ' + i + ', ' + value + '>\n';
        }

        if (value == null) {
            return '<' + url + ', ' + i + ', ' + 'null' + '>\n';
        }
    }

    function map_field(url, obj, i) {
        var value = obj[i];

        if (i === "@context") return "";

        if (typeof value === "string") {
            return '<' + url + ', ' + i + ', ' + value + '>\n';
        }

        if (typeof value === "number") {
            return '<' + url + ', ' + i + ', ' + value + '>\n';
        }

        if (typeof value === "object") {
            var s = "";
            for (var j in value) {
                s += '<' + url + ', ' + i + ', ' + j + '>\n';
                if (typeof value[j] === "string") s += '<' + j + ', type, ' + value[j] + '>\n'; else if (typeof value[j] === "object") {
                    for (var k in value[j]) {
                        s += '<' + j + ', param, ' + k + '>\n';
                        if (typeof value[j][k] === "string") s += '<' + k + ', type, ' + value[j][k] + '>\n';
                    }
                }
            }
            return s;
        }

        if (typeof value === "array") {
            return '<' + url + ', ' + i + ', ' + value + '>\n';
        }

        if (value == null) {
            return '<' + url + ', ' + i + ', ' + 'null' + '>\n';
        }
    }

</script>
</body>
</html>